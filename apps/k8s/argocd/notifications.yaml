apiVersion: v1
kind: ConfigMap
metadata:
  name: argocd-notifications-cm
  namespace: argocd
data:
  context: |
    argocdUrl: https://argocd.codedang.com

  service.github: |
    appID: $githubAppID
    installationID: $githubAppInstallationID
    privateKey: $githubAppPrivateKey

  # trigger.on-sync-succeeded: |
  #   when: 'hi' == 'hi'
  #   send: [app-deployed]

  trigger.on-sync-succeeded: |
    - when: app.status.operationState.phase == 'Succeeded'
      send:
      - github-pr-comment      # Send the GitHub PR comment

  template.app-deployed: |
    message: |
      Application {{.app.metadata.name}} deployed successfully!
      See details: {{.context.argocdUrl}}/applications/{{.app.metadata.name}}
    github:
      pullRequestComment:
        content: |
          ðŸš€ **Deployment Complete**
          Application: {{.app.metadata.name}}
          Status: {{.app.status.sync.status}}
          [View in ArgoCD]({{.context.argocdUrl}}/applications/{{.app.metadata.name}})

  template.github-pr-comment: |
    message: |
      âœ… **Sync Succeeded** to {{.app.spec.destination.name}}
      The application `{{.app.metadata.name}}` has been successfully synced to the target destination.

      **Application:** `{{.app.metadata.name}}`
      **Sync Status:** `{{.app.status.sync.status}}`
      **Health Status:** `{{.app.status.health.status}}`
      **Revision:** `{{.app.status.sync.revision}}`

      [View in Argo CD]({{.context.argocdUrl}}/applications/{{.app.metadata.name}})
