apiVersion: v1
kind: ConfigMap
metadata:
  name: argocd-notifications-cm
  namespace: argocd
data:
  context: |
    argocdUrl: https://argocd.codedang.com

  service.github: |
    appID: $githubAppID
    installationID: $githubAppInstallationID
    privateKey: $githubAppPrivateKey

  trigger.on-sync-succeeded: |
    - when: app.status.sync.status == 'Synced'
      oncePer: app.status.sync.revision
      send: [github]

  template.github: |
    message: 'Test message from ArgoCD Notifications'
    github:
      pullRequestComment:
        content: |
          {{if eq .app.status.sync.status "Synced"}}
          ✅ **Sync Succeeded**
          {{else}}
          ❌ **Sync Status: {{ .app.status.sync.status }}**
          {{end}}

          **Application:** `{{ .app.metadata.name }}`
          **Health Status:** {{ .app.status.health.status }}
          **Revision:** `{{ .app.status.sync.revision }}`

          [View in Argo CD]({{.context.argocdUrl}}/applications/{{.app.metadata.name}})
      checkRun:
        name: "argocd/{{.app.metadata.name}}"
        details_url: "{{.context.argocdUrl}}/applications/{{.app.metadata.name}}?operation=true"
        status: completed
        conclusion: success
        started_at: "YYYY-MM-DDTHH:MM:SSZ"
        completed_at: "YYYY-MM-DDTHH:MM:SSZ"
        output:
          title: "Deployment of {{.app.metadata.name}} on ArgoCD"
          summary: "Application {{.app.metadata.name}} is now running new version of deployments manifests."
          text: |
            Application {{.app.metadata.name}} is now running new version of deployments manifests.
            See more here: {{.context.argocdUrl}}/applications/{{.app.metadata.name}}?operation=true
