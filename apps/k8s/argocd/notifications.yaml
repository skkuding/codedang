apiVersion: v1
kind: ConfigMap
metadata:
  name: argocd-notifications-cm
  namespace: argocd
data:
  context: |
    argocdUrl: https://argocd.codedang.com

  service.github: |
    appID: $githubAppID
    installationID: $githubAppInstallationID
    privateKey: $githubAppPrivateKey

  trigger.on-sync-failed: |
    - when: app.status.sync.status != 'Synced'
      oncePer: app.status.sync.revision
      send: [github]

  trigger.on-sync-running: |
    - when: app.status.sync.status == 'Syncing'
      oncePer: app.status.sync.revision
      send: [github]

  trigger.on-sync-succeeded: |
    - when: app.status.sync.status == 'Synced'
      oncePer: app.status.sync.revision
      send: [github]

  template.github: |
    message: 'Successfully synced {{ .app.metadata.name }}'
    github:
      status:
        state: success
        label: "Argo CD / {{ .app.metadata.name }}"
        targetURL: "{{ .context.argocdUrl }}/applications/{{ .app.metadata.name }}?operation=true"
      pullRequestComment:
        content: |
          âœ… **Sync Succeeded**

          **Application:** `{{ .app.metadata.name }}`
          **Revision:** `{{ .app.status.sync.revision }}`
          **Health Status:** {{ .app.status.health.status }}

          [Open Preview]({{ .app.status.summary.externalURLs[0] }})
          [View in Argo CD]({{ .context.argocdUrl }}/applications/{{ .app.metadata.name }})
