version: '3'

services:
  caddy:
    image: caddy:2.7.5-alpine
    container_name: caddy
    depends_on:
      - backend-client
      - backend-admin
      - iris
    restart: unless-stopped
    ports:
      - '80:80'
      - '443:443'
    volumes:
      - $PWD/Caddyfile:/etc/caddy/Caddyfile
      - $PWD/dist:/var/www/html
    network_mode: host

  backend-client:
    image: ghcr.io/skkuding/codedang-client-api:latest
    container_name: backend-client
    depends_on:
      - rabbitmq
      - database
    env_file: .env.development
    environment:
      JWT_SECRET: fb503fae3c40b700d7f10ca32f24b5bc10f78979cd0e8aa73fab076a5fb9e2a3
    network_mode: host

  backend-admin:
    image: ghcr.io/skkuding/codedang-admin-api:latest
    container_name: backend-admin
    depends_on:
      - rabbitmq
      - database
    env_file: .env.development
    environment:
      JWT_SECRET: fb503fae3c40b700d7f10ca32f24b5bc10f78979cd0e8aa73fab076a5fb9e2a3
    network_mode: host

  iris:
    image: ghcr.io/skkuding/codedang-iris:latest
    container_name: iris
    depends_on:
      - rabbitmq
      - database
    env_file: .env.development
    network_mode: host
