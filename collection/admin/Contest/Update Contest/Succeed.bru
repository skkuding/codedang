meta {
  name: Succeed
  type: graphql
  seq: 1
}

post {
  url: {{gqlUrl}}
  body: graphql
  auth: none
}

body:graphql {
  mutation UpdateContest(
    $contestId: Int!,
    $input: UpdateContestInput!
  ) {
    updateContest(
      contestId: $contestId
      input: $input
    ) {
      id
      title
      description
      startTime
      endTime
      registerDueTime
      unfreeze
      freezeTime
      enableCopyPaste
      isJudgeResultVisible
      invitationCode
      summary
      userContest {
        userId
        role
      }
    }
  }
}

body:graphql:vars {
  {
    "contestId": 19,
    "input": {
      "title": "Updated Contest 2",
      "description": "thisisupdatedcontest",
      "startTime": "2025-01-01",
      "endTime": "2030-01-01",
      "registerDueTime": "2023-01-01",
      "enableCopyPaste": true,
      "isJudgeResultVisible": true,
      "invitationCode": "123456",
      "summary": {
        "참여대상": "updatedparticipationTarget",
        "진행방식": "updatedcompetitionMethod",
        "순위산정": "updatedrankingMethod",
        "문제형태": "updatedproblemFormat",
        "참여혜택": "updatedbenefits"
      }
    }
  }
}

assert {
  res.body.data.updateContest: isDefined
}

script:pre-request {
  await require("./login").loginContestAdmin(req);
}

docs {
  # 📘 Update Contest

  **POST** `/graphql (mutation: updateContest)`

  Updates the details of an existing contest.

  기존 대회의 정보를 수정합니다.

  대회 정보 외에 대회 스태프(`Manager`, `Reviewer`)도 이 API를 통해 추가, 수정, 삭제할 수 있습니다.

  대회 시간이 변경될 경우, 연관된 문제들의 `visibleLockTime`도 함께 재계산되어 업데이트됩니다.

  ---

  ### 🔒 Authentication

  ✅ Required (Contest Staff)

  ---

  ## 요청 필드
  | 필드명 | 타입 | 필수 여부 | 설명 |
  |--------|------|----------|------|
  | `id` | Int | ✅ | 업데이트할 콘테스트의 ID |
  | `title` | String | ❌ | 대회 제목 |
  | `description` | String | ❌ | 대회 설명 |
  | `startTime` | GraphQLISODateTime | ❌ | 대회 시작 시간 |
  | `endTime` | GraphQLISODateTime | ❌ | 대회 종료 시간 |
  | `registerDueTime` | GraphQLISODateTime | ❌ | 참가 등록 마감 시간 |
  | `isJudgeResultVisible` | Boolean | ❌ | 채점 결과 공개 여부 |
  | `penalty` | Int | ❌ | 대회 페널티 점수 |
  | `lastPenalty` | Boolean | ❌ | 마지막 패널티 적용 여부 |
  | `posterUrl` | String | ❌ | 포스터 이미지 URL |
  | `invitationCode` | String | ❌ | 6자리 초대 코드 |
  | `freezeTime`| GraphQLISODateTime | ❌ | 리더보드 동결 시작 시간 |
  | `enableCopyPaste` | Boolean | ❌ | 복사/붙여넣기 허용 여부 |
  | `evaluateWithSampleTestcase` | Boolean | ❌ | 예제 테스트케이스로만 채점 여부 |
  | `userContest` | [UserContestInput] | ❌ | 대회 관리자/리뷰어 역할 부여 |
  | `summary` | GraphQLJSON | ❌ | 대회 관련 요약 정보 (Key-Value) |

  *`UpdateContestInput`의 상세 필드는 `createContest`의 `input`과 대부분 동일합니다.*

  ---

  ### 📤 Response Body

  #### Content-Type: `application/json`

  ```json
  {
    "data": {
      "updateContest": {
        "id": "19",
        "title": "Updated Contest 2",
        "description": "thisisupdatedcontest",
        "startTime": "2025-01-01T00:00:00.000Z",
        "endTime": "2030-01-01T00:00:00.000Z",
        "registerDueTime": "2023-01-01T00:00:00.000Z",
        "unfreeze": false,
        "freezeTime": null,
        "enableCopyPaste": true,
        "isJudgeResultVisible": true,
        "invitationCode": "123456",
        "summary": {
          "문제형태": "updatedproblemFormat",
          "순위산정": "updatedrankingMethod",
          "진행방식": "updatedcompetitionMethod",
          "참여대상": "updatedparticipationTarget",
          "참여혜택": "updatedbenefits"
        },
        "userContest": [
          {
            "userId": 5,
            "role": "Manager"
          },
          {
            "userId": 6,
            "role": "Reviewer"
          }
        ]
      }
    }
  }
  ```
}
